---
title: Mobile App Versioning
---

## 问题背景

功能特性标志（Feature Flags）在管理移动应用功能时尤为关键。当移动应用出现缺陷时，修复补丁触达用户设备存在显著延迟：

1. 需等待应用商店审核（尽管近年来审核周期已大幅缩短）
2. 新版本上架后，还需等待用户主动升级应用，这个过程可能持续数周甚至数月

这两个问题叠加时，若线上出现缺陷将造成严重困扰。此时功能标志就能大显身手...

## 解决方案

我们将创建受影响用户分群（Segment），并针对这部分用户单独覆盖（本例中禁用）问题功能。具体操作步骤如下：

### 1. 为功能添加标志控制

虽然看似基础，但若未用标志包装功能，将丧失远程控制能力。建议将新功能/代码封装在标志中作为开发规范，以便实现远程管理。

### 2. 向Flagsmith同步设备及应用版本信息

通过[身份与特征值](/basic-features/managing-identities.md)机制，确保传输设备类型和版本数据至Flagsmith。推荐使用以下特征值：

- 平台类型（iOS或Android）
- 系统版本（如Android 11，iOS 14）
- 应用版本号（即应用商店显示的发布版本号）

### 3. 定位缺陷范围

当不可避免出现缺陷时（无需担心，这是开发者常态），在用户反馈涌入后需快速定位受影响设备范围：

- 是否仅限最新发布的iOS版本？
- 还是所有Android设备均受影响？
- 或许缺陷实际存在于两个版本前，但刚被发现？

这通常是流程中最困难的环节。需努力精确定义最小范围的受影响用户群体。

### 4. 基于缺陷创建用户分群

:::tip

可运用[语义化版本操作符](/basic-features/managing-segments#semver-aware-operators)来构建分群规则

:::

根据第3步分析结果，在Flagsmith中创建匹配受影响用户的[分群](/basic-features/managing-segments.md)。例如假设最新发布版本为`5.4.1`，但发现缺陷实际始于`5.4.0`，且仅影响iOS设备。此时分群应包含两条规则：

- 特征值`platform` _等于_ `iOS`
- 特征值`version` _语义版本 >=_ `5.4.0` **且** _语义版本 <=_ `5.4.1`

### 5. 为分群设置功能覆盖

定位问题功能，进入覆盖（Overrides）标签页，添加第4步定义的分群，并将该功能覆盖设置为**_禁用_**状态。

现在可以松口气了...

## 实现原理

通过上述步骤，我们精确锁定了受影响的用户子集。对于其他用户（本例中的Android用户及版本低于`5.4.0`的iOS用户），功能仍保持可用状态；仅对问题用户群禁用该功能。

因此，我们创建了一个精准识别受影响用户的用户分群，并利用该分群对功能进行覆盖——**_仅针对这些特定用户_**。

## 后续步骤

首先（虽然显而易见但值得强调），发布修复版本！推送修复问题的5.4.2版本。当用户升级后，其`version`特征值将自动变更为5.4.2，从而脱离该分群。Flagsmith随后会开始向这些用户发送该功能的启用标志，用户即可访问已修复的功能。

我们可以保留这个分群及其覆盖设置。实际上这非常关键！许多用户根本不会主动更新应用。但没关系——只要分群规则持续生效，这些用户就永远不会察觉你曾发布过有缺陷的版本。