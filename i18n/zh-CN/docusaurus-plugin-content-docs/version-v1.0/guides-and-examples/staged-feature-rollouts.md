---
title: Staged Feature Rollouts
---

## 什么是分阶段功能发布

分阶段功能发布允许您在小部分用户群体中测试新功能。若功能表现良好，可逐步增加可见用户比例，直至覆盖全部用户群。

该方法能提升新功能发布的信心。若发布过程中出现问题，只需禁用功能开关即可在应用中隐藏该功能。

## 创建分阶段发布

:::important

分阶段发布**_仅_**在针对特定用户身份获取功能开关时生效。若仅获取环境级别的开关而未传入用户身份，该用户将永远不会被纳入"百分比分割"用户群组。

:::

您可以通过创建[用户群组](/basic-features/managing-segments.md)并添加"百分比分割"条件规则来实现分阶段发布。设置1到100之间的百分比值即可定义纳入该群组的用户比例。

![图示](/img/percent-rollout.png)

创建群组后，可按照常规[用户群组](/basic-features/managing-segments.md)操作将其关联至功能开关。

注意：您可以根据需要将"百分比分割"规则与其他群组规则组合使用。

## 工作原理

每个用户身份和群组都有唯一标识符。这两组数据经合并哈希后，会生成0.0到1.0之间的浮点值。该数值将与"百分比分割"规则进行比对。

### 示例说明

以单个用户身份为例，具体步骤如下：

1. 获取内部群组ID和用户身份ID并合并为字符串
2. 对该字符串进行哈希运算
3. 基于哈希值生成0到1之间的浮点数

因此每个群组/用户身份组合都会生成0到1之间的值。通过哈希算法确保数值在0到1区间均匀分布。

假设某用户身份的计算结果为0.351。若群组分割比例设为30%，则该用户不会被纳入群组（0.351 > 0.3）。若将分割比例调整为40%，该用户将被纳入群组（0.4 > 0.351）。由于群组ID创建后不变，终端用户可获得一致的体验。

第二个用户身份的哈希值可能是0.94。这种情况下，无论分割比例设为30%还是40%，该用户都不会被纳入群组。