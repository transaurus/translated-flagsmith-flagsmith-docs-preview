---
description: Group your users based on a set of rules, then control Feature Flags and Remote Config for those groups.
---

# 管理用户分群

用户分群功能允许您基于一组规则对用户进行分组，进而针对这些分组控制功能开关和远程配置。您可以创建分群规则，然后为该分群用户覆盖功能开关状态或远程配置值。

:::important

分群定义在项目环境间共享。若在某环境中修改分群规则，该变更将同步至该项目所有环境。

:::

功能开关和配置的分群覆盖在环境级别生效，这意味着不同环境可以定义各自的分群覆盖规则。

:::tip

分群数据_不会_回传至客户端SDK。它们仅用于在仪表盘中覆盖开关值，API永远不会将分群信息返回给SDK。
[了解架构详情](/guides-and-examples/integration-approaches#flags-are-evaluated-server-side)。

:::

## 示例 - 测试版用户

假设您希望将所有团队成员自动归为`测试版用户`。当前所有登录用户都通过[身份标识](/basic-features/managing-identities.md)功能，使用电子邮件地址及某些[特征值](/basic-features/managing-identities.md#identity-traits)进行识别。

您可以新建名为`测试版用户`的分群，并定义如下规则：

- `email_address` 包含 `@flagsmith.com`

![图片](/img/edit-segment.png)

定义分群后，可将其关联至特定功能开关。编辑目标功能开关时，在"分群覆盖"下拉菜单中选择该分群。当识别用户属于该分群时，开关值将被覆盖。

![图片](/img/edit-feature-with-segment.png)

对于所有测试版相关功能开关，您可将`测试版用户`分群与每个开关关联，并为该分群设置开关值为`true`。通过编辑功能开关，在"分群覆盖"下拉菜单中选定分群即可实现。

至此，所有使用含`@flagsmith.com`邮箱登录的用户都将启用全部测试功能。

假设您需要与另一家公司合作，为其开放测试功能访问权限。只需修改分群规则：

- `email_address` 包含 `@flagsmith.com`
- `email_address` 包含 `@solidstategroup.com`

现在所有使用`@solidstategroup.com`邮箱登录的用户将自动获得测试功能权限。

## 规则运算符

Flagsmith支持的完整运算符集合如下：

- `完全匹配 (=)`
- `不匹配 (!=)`
- `百分比分割 (%)`
- `大于 (>)`
- `大于等于 (>=)`
- `小于 (<)`
- `小于等于 (<=)`
- `包含`
- `不包含`
- `正则匹配`

所有运算符行为均符合常规预期，部分运算符还具备特殊能力！

### 语义化版本感知运算符

同时支持以下[语义化版本](https://semver.org/)运算符：

- `语义版本 >`
- `语义版本 >=`
- `语义版本 <`
- `语义版本 <=`

例如，若您采用语义化版本控制系统管理应用版本，可将版本号作为`特征值`存储在Flagsmith中，然后创建如下规则：

`version` `语义版本 >=` `4.2.52`

该分群规则将包含所有运行4.2.52及以上版本应用的用户。

### 百分比分割运算符

:::important

百分比分割运算符 **_仅_** 在针对特定身份获取功能标志时生效。如果仅针对环境检索标志而未传入身份标识，您的用户将 **_永远不会_** 被包含在百分比分割的区段中。

:::

这是唯一不需要特征的运算符。您可以使用百分比分割运算符来驱动
[A/B测试](/advanced-use/ab-testing) 和
[分阶段功能发布](/guides-and-examples/staged-feature-rollouts#creating-staged-rollouts)。

## 功能标志与远程配置的优先级

功能标志状态和远程配置值可在三个不同位置定义：

1. 标志/配置本身的默认值
2. 与标志/配置关联的区段
3. 在身份级别覆盖的值

例如，功能标志`显示PayPal结账`可能在标志本身设为`false`，在"Beta用户"区段设为`true`，然后针对特定身份覆盖为`false`。

为处理这种情况，存在以下优先级顺序：

1. 若身份存在覆盖值，则优先返回该值（高于区段和标志/配置）
2. 若无身份覆盖，则检查并返回有效的区段值
3. 若既无身份也无区段覆盖，则使用默认的标志/配置值

简而言之，优先级顺序为：

1. 身份
2. 区段
3. 标志