---
title: Mobile App Versioning
---

## 问题背景

功能开关在管理移动应用特性时展现出独特价值。当移动应用中出现缺陷时，修复补丁触达用户设备存在显著延迟：

1. 需等待应用商店审核（近年来审核周期已大幅缩短）
2. 新版本上架后，用户可能需要数周甚至数月才会完成应用升级

这两个问题叠加时，线上缺陷会造成严重困扰。此时功能开关便能大显身手...

## 解决方案

我们将创建受影响用户分群，并针对性地对这部分用户禁用问题功能。具体实施步骤如下：

### 1. 为功能添加开关

虽然显而易见，但若未用功能开关封装特性，将丧失远程控制能力。建议将新功能/代码封装至开关中作为开发规范。

### 2. 向Flagsmith同步设备及应用版本信息

通过[身份与特征值](/basic-features/managing-identities.md)机制，确保传输设备类型和版本数据至Flagsmith。推荐使用以下特征值：

- 平台（iOS或Android）
- 系统版本（如Android 11, iOS 14）
- 应用版本（即应用商店显示的版本号）

### 3. 定位缺陷范围

当不可避免出现缺陷时（无需担心，这是开发者常态），根据用户反馈快速界定受影响设备范围：

- 是否仅影响最新发布的iOS版本？
- 或是所有Android设备均出现异常？
- 可能该缺陷实际存在于前两个版本中？

此阶段通常最为困难。需精确定义最小范围的受影响用户群体。

### 4. 基于缺陷创建用户分群

:::tip

可运用[语义化版本操作符](/basic-features/managing-segments#semver-aware-operators)来构建分群规则

:::

根据第3步分析结果，在Flagsmith中创建对应[分群](/basic-features/managing-segments.md)。例如：最新发布版本为`5.4.1`，但发现缺陷实际始于`5.4.0`，且仅影响iOS设备。此时分群规则应包含：

- 特征值`platform`等于`iOS`
- 特征值`version`满足语义化版本`>=5.4.0`且`<=5.4.1`

### 5. 针对分群覆盖功能开关

定位问题功能，进入覆盖选项卡，添加第4步定义的分群，并将该功能覆盖设置为**_禁用_**状态。

现在可以松口气了...

## 实现原理

通过上述步骤，我们精确锁定了受影响的用户子集。在保持其他用户（Android用户及版本低于`5.4.0`的iOS用户）正常使用功能的同时，仅对问题用户禁用该特性。

因此，我们创建了一个精准识别受影响用户的用户分群，并利用该分群对功能进行覆盖——**_但仅针对这些特定用户_**。

## 后续会发生什么？

首先（虽然听起来显而易见但值得强调），发布修复版本！推送修复问题的5.4.2版本。当用户升级后，其`version`特征值将自动变更为5.4.2，从而脱离该分群。Flagsmith随后会开始向这些用户发送该功能的启用标志，用户即可访问已修复的功能。

我们可以保留这个分群及其覆盖设置。事实上，这非常必要！许多用户根本不会主动升级应用。但这并无妨——只要分群规则持续生效，这些用户就永远不会察觉你曾发布过有缺陷的版本。